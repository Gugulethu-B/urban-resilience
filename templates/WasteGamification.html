<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Waste Gamification - Green City Management</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
  <style>
    body { background: #fff; }
    .gradient-bg { background: none; }
    .card, .border-box {
      border: 2px solid #e0e0e0 !important;
      border-radius: 16px !important;
      box-shadow: 0 2px 12px rgba(0,0,0,0.04);
      transition: box-shadow 0.2s, border-color 0.2s;
    }
    .card:hover, .border-box:hover {
      border-color: #198754 !important;
      box-shadow: 0 4px 24px rgba(25,135,84,0.12);
    }
    .btn-success, .btn-primary {
      font-size: 1.15rem;
      padding: 0.75rem 2rem;
      border-radius: 8px;
      transition: background 0.2s, box-shadow 0.2s;
    }
    .btn-success:hover, .btn-primary:hover {
      background: #157347 !important;
      box-shadow: 0 2px 8px rgba(25,135,84,0.15);
    }
    .h1, .h2, .h3, .h4 {
      font-weight: 700;
      letter-spacing: 0.5px;
    }
    .stat-value {
      font-size: 2.2rem;
      font-weight: 700;
      color: #198754;
    }
    .stat-label {
      font-size: 1.1rem;
      font-weight: 500;
      color: #555;
    }
    .leaderboard-card .circle-step {
      font-size: 1.3rem;
      width: 2.2rem;
      height: 2.2rem;
      line-height: 2.2rem;
    }
    .leaderboard-card:hover {
      background: #e6ffed;
      border-color: #198754 !important;
    }
    .icon-circle, .icon-circle-lg {
      border: 2px solid #e0e0e0;
      transition: border-color 0.2s;
    }
    .icon-circle:hover, .icon-circle-lg:hover {
      border-color: #198754;
    }
    /* Remove all background colors from sections */
    section, .gradient-bg {
      background: none !important;
    }
  </style>
</head>
<body>
  <!-- Navigation -->
  <nav class="navbar navbar-expand-lg navbar-light bg-white shadow-sm mb-4 fixed-top">
    <div class="container">
      <a class="navbar-brand fw-bold" href="/"><i class="fa-solid fa-leaf text-success me-2"></i>Green City Hack</a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav ms-auto">
          <li class="nav-item"><a class="nav-link" href="/">Home</a></li>
          <li class="nav-item"><a class="nav-link" href="/admin">Admin</a></li>
          <li class="nav-item"><a class="nav-link" href="/carbon">Carbon</a></li>
          <li class="nav-item"><a class="nav-link" href="/flood/alerts">Flood</a></li>
          <li class="nav-item"><a class="nav-link" href="/heat">Heat</a></li>
          <li class="nav-item"><a class="nav-link active" href="/waste">Waste</a></li>
          <li class="nav-item">
            <button class="btn btn-success ms-3" data-bs-toggle="modal" data-bs-target="#authModal">Sign Up / Login</button>
          </li>
        </ul>
      </div>
    </div>
  </nav>

  <!-- EcoSort Scan Section (moved to top) -->
  <section class="py-5">
    <div class="container">
      <div class="row align-items-center mb-4 border-box">
        <div class="col-md-7">
          <h1 class="h1 fw-bold mb-3"><i class="fa-solid fa-recycle text-success me-2"></i>EcoSort Waste Gamification</h1>
          <p class="lead text-muted" style="font-size:1.25rem;">
            Welcome to <span class="fw-bold text-success">EcoSort</span>, your smart companion for sustainable living! Scan your waste items using our AI-powered recognition tool and instantly discover the best way to recycle. Earn points, climb the leaderboard, and unlock eco-friendly rewards as you help make your city greener. <span class="fw-bold text-success">Every scan makes a difference!</span>
          </p>
          <ul class="list-unstyled mb-4" style="font-size:1.15rem;">
            <li><i class="fa-solid fa-check text-success me-2"></i>Instant AI waste classification</li>
            <li><i class="fa-solid fa-check text-success me-2"></i>Earn points for every correct scan</li>
            <li><i class="fa-solid fa-check text-success me-2"></i>Compete in challenges and win rewards</li>
            <li><i class="fa-solid fa-check text-success me-2"></i>Track your impact and join the leaderboard</li>
          </ul>
          <button class="btn btn-success btn-lg" data-bs-toggle="modal" data-bs-target="#ecosortModal">
            <i class="fa-solid fa-camera me-2"></i>Scan Waste with EcoSort
          </button>
          <div id="ecosort-recognition-result" class="mt-3"></div>
        </div>
        <div class="col-md-5 text-center">
          <img src="{{ url_for('static', filename='img/ecosort-hero.png') }}" alt="EcoSort AI Waste Scanner" class="img-fluid rounded shadow-sm" style="max-width: 350px;">
        </div>
      </div>
    </div>
  </section>

  <!-- EcoSort Modal -->
  <div class="modal fade" id="ecosortModal" tabindex="-1" aria-labelledby="ecosortModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <form id="ecosortForm" enctype="multipart/form-data">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="ecosortModalLabel">EcoSort Waste Recognition</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <div class="mb-3">
              <label for="ecosortImage" class="form-label">Upload or capture an image of your waste item:</label>
              <input class="form-control" type="file" id="ecosortImage" name="wasteImage" accept="image/*" capture="environment" required>
            </div>
            <div id="ecosort-modal-result" class="text-center"></div>
          </div>
          <div class="modal-footer">
            <button type="submit" class="btn btn-success">Classify with EcoSort</button>
          </div>
        </div>
      </form>
    </div>
  </div>

  <!-- Header Stats & Leaderboard Section -->
  <section class="py-4">
    <div class="container">
      <div class="row g-4">
        <div class="col-md-3">
          <div class="card h-100 text-center">
            <div class="card-body">
              <div class="stat-label mb-1">Active Users</div>
              <div class="stat-value mb-2">1,247</div>
              <i class="fa-solid fa-users text-success fa-2x"></i>
              <span class="badge bg-secondary mt-2"><i class="fa-solid fa-arrow-trend-up me-1"></i>+15% this week</span>
            </div>
          </div>
        </div>
        <div class="col-md-3">
          <div class="card h-100 text-center">
            <div class="card-body">
              <div class="stat-label mb-1">Items Scanned</div>
              <div class="stat-value mb-2">4,674</div>
              <i class="fa-solid fa-camera text-primary fa-2x"></i>
              <div class="small text-muted mt-2">91% accuracy rate</div>
            </div>
          </div>
        </div>
        <div class="col-md-3">
          <div class="card h-100 text-center">
            <div class="card-body">
              <div class="stat-label mb-1">Points Awarded</div>
              <div class="stat-value mb-2">89,240</div>
              <i class="fa-solid fa-star text-warning fa-2x"></i>
              <div class="small text-muted mt-2">This month</div>
            </div>
          </div>
        </div>
        <div class="col-md-3">
          <div class="card h-100 text-center">
            <div class="card-body">
              <div class="stat-label mb-1">Challenges Active</div>
              <div class="stat-value mb-2">8</div>
              <i class="fa-solid fa-trophy text-purple-500 fa-2x"></i>
              <div class="small text-muted mt-2">3 ending soon</div>
            </div>
          </div>
        </div>
      </div>
      <div class="row g-4 mt-4">
        <!-- Community Leaderboard -->
        <div class="col-lg-6">
          <div class="card h-100 leaderboard-card">
            <div class="card-header fw-bold">Community Leaderboard <span class="text-muted small fw-normal">Top performers in waste recognition and recycling</span></div>
            <div class="card-body">
              <div class="mb-3 d-flex align-items-center justify-content-between p-2 bg-light rounded">
                <div class="d-flex align-items-center">
                  <span class="d-inline-block text-center rounded-circle bg-primary text-white fw-bold me-2 circle-step">1</span>
                  <div>
                    <div class="fw-medium">EcoWarrior2024</div>
                    <div class="small text-muted">156 items scanned</div>
                  </div>
                </div>
                <div class="text-end">
                  <span class="d-inline-block rounded-circle bg-warning me-2 dot-small"></span>
                  <span class="fw-bold">2847</span><br>
                  <span class="small text-muted">points</span>
                </div>
              </div>
              <div class="mb-3 d-flex align-items-center justify-content-between p-2 bg-light rounded">
                <div class="d-flex align-items-center">
                  <span class="d-inline-block text-center rounded-circle bg-primary text-white fw-bold me-2 circle-step">2</span>
                  <div>
                    <div class="fw-medium">GreenHero</div>
                    <div class="small text-muted">134 items scanned</div>
                  </div>
                </div>
                <div class="text-end">
                  <span class="d-inline-block rounded-circle bg-gray-400 me-2 dot-small"></span>
                  <span class="fw-bold">2103</span><br>
                  <span class="small text-muted">points</span>
                </div>
              </div>
              <div class="mb-3 d-flex align-items-center justify-content-between p-2 bg-light rounded">
                <div class="d-flex align-items-center">
                  <span class="d-inline-block text-center rounded-circle bg-primary text-white fw-bold me-2 circle-step">3</span>
                  <div>
                    <div class="fw-medium">RecycleChamp</div>
                    <div class="small text-muted">98 items scanned</div>
                  </div>
                </div>
                <div class="text-end">
                  <span class="d-inline-block rounded-circle bg-orange-600 me-2 dot-small"></span>
                  <span class="fw-bold">1892</span><br>
                  <span class="small text-muted">points</span>
                </div>
              </div>
              <div class="mb-3 d-flex align-items-center justify-content-between p-2 bg-light rounded">
                <div class="d-flex align-items-center">
                  <span class="d-inline-block text-center rounded-circle bg-primary text-white fw-bold me-2 circle-step">4</span>
                  <div>
                    <div class="fw-medium">EarthGuardian</div>
                    <div class="small text-muted">87 items scanned</div>
                  </div>
                </div>
                <div class="text-end">
                  <span class="d-inline-block rounded-circle bg-orange-600 me-2 dot-small"></span>
                  <span class="fw-bold">1654</span><br>
                  <span class="small text-muted">points</span>
                </div>
              </div>
              <div class="mb-3 d-flex align-items-center justify-content-between p-2 bg-light rounded">
                <div class="d-flex align-items-center">
                  <span class="d-inline-block text-center rounded-circle bg-primary text-white fw-bold me-2 circle-step">5</span>
                  <div>
                    <div class="fw-medium">CleanCityFan</div>
                    <div class="small text-muted">76 items scanned</div>
                  </div>
                </div>
                <div class="text-end">
                  <span class="d-inline-block rounded-circle bg-orange-600 me-2 dot-small"></span>
                  <span class="fw-bold">1432</span><br>
                  <span class="small text-muted">points</span>
                </div>
              </div>
              <a href="#" class="btn btn-outline-secondary w-100 mt-3"><i class="fa-solid fa-trophy me-2"></i>View Full Leaderboard</a>
            </div>
          </div>
        </div>
        <!-- Active Challenges -->
        <div class="col-lg-6">
          <div class="card h-100">
            <div class="card-header fw-bold">Active Challenges <span class="text-muted small fw-normal">Complete challenges to earn extra points</span></div>
            <div class="card-body">
              <div class="mb-3 p-3 border rounded">
                <div class="d-flex justify-content-between mb-2">
                  <span class="fw-medium">Plastic Free Week</span>
                  <span class="badge bg-secondary">Active</span>
                </div>
                <div class="row small align-items-center">
                  <div class="col">Progress<br><span class="fw-medium">67/100</span></div>
                  <div class="col">Reward<br><span class="fw-medium">250 points</span></div>
                  <div class="col">Status<br><span class="fw-medium">Active</span></div>
                </div>
                <div class="progress mt-2 progress-custom">
                  <div class="progress-bar bg-secondary progress-bar-67" role="progressbar" aria-label="Step Progress 1"></div>
                </div>
              </div>
              <div class="mb-3 p-3 border rounded">
                <div class="d-flex justify-content-between mb-2">
                  <span class="fw-medium">Glass Collection</span>
                  <span class="badge bg-primary">Complete</span>
                </div>
                <div class="row small align-items-center">
                  <div class="col">Progress<br><span class="fw-medium">89/50</span></div>
                  <div class="col">Reward<br><span class="fw-medium">150 points</span></div>
                  <div class="col">Status<br><span class="fw-medium">Complete</span></div>
                </div>
                <div class="progress mt-2 progress-custom">
                  <div class="progress-bar bg-primary progress-bar-100" role="progressbar" aria-label="Step Progress 2"></div>
                </div>
              </div>
              <div class="mb-3 p-3 border rounded">
                <div class="d-flex justify-content-between mb-2">
                  <span class="fw-medium">E-Waste Drive</span>
                  <span class="badge bg-secondary">Active</span>
                </div>
                <div class="row small align-items-center">
                  <div class="col">Progress<br><span class="fw-medium">23/30</span></div>
                  <div class="col">Reward<br><span class="fw-medium">300 points</span></div>
                  <div class="col">Status<br><span class="fw-medium">Active</span></div>
                </div>
                <div class="progress mt-2 progress-custom">
                  <div class="progress-bar bg-secondary progress-bar-77" role="progressbar" aria-label="Step Progress 3"></div>
                </div>
              </div>
              <div class="mb-3 p-3 border rounded">
                <div class="d-flex justify-content-between mb-2">
                  <span class="fw-medium">Community Clean-up</span>
                  <span class="badge bg-secondary">Active</span>
                </div>
                <div class="row small align-items-center">
                  <div class="col">Progress<br><span class="fw-medium">45/20</span></div>
                  <div class="col">Reward<br><span class="fw-medium">500 points</span></div>
                  <div class="col">Status<br><span class="fw-medium">Active</span></div>
                </div>
                <div class="progress mt-2 progress-custom">
                  <div class="progress-bar bg-secondary progress-bar-100" role="progressbar" aria-label="Step Progress 4"></div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <!-- AI Waste Recognition Stats -->
      <div class="card mt-5">
        <div class="card-header fw-bold">EcoSort Waste Recognition <span class="text-muted small fw-normal">AI-powered waste classification and gamification</span></div>
        <div class="card-body">
          <div class="row g-3">
            <div class="col-md-2 text-center">
              <div class="rounded-circle bg-blue-500 mx-auto mb-2 icon-circle"><i class="fa-solid fa-recycle text-white fa-lg icon-circle-icon"></i></div>
              <div class="fw-semibold">Plastic</div>
              <div class="fw-bold">1247</div>
              <div class="small text-muted">items recognized</div>
              <span class="badge bg-outline">94% accuracy</span>
            </div>
            <div class="col-md-2 text-center">
              <div class="rounded-circle bg-green-500 mx-auto mb-2 icon-circle"><i class="fa-solid fa-recycle text-white fa-lg icon-circle-icon"></i></div>
              <div class="fw-semibold">Glass</div>
              <div class="fw-bold">892</div>
              <div class="small text-muted">items recognized</div>
              <span class="badge bg-outline">97% accuracy</span>
            </div>
            <div class="col-md-2 text-center">
              <div class="rounded-circle bg-gray-500 mx-auto mb-2 icon-circle"><i class="fa-solid fa-recycle text-white fa-lg icon-circle-icon"></i></div>
              <div class="fw-semibold">Metal</div>
              <div class="fw-bold">654</div>
              <div class="small text-muted">items recognized</div>
              <span class="badge bg-outline">91% accuracy</span>
            </div>
            <div class="col-md-2 text-center">
              <div class="rounded-circle bg-yellow-500 mx-auto mb-2 icon-circle"><i class="fa-solid fa-recycle text-white fa-lg icon-circle-icon"></i></div>
              <div class="fw-semibold">Paper</div>
              <div class="fw-bold">1103</div>
              <div class="small text-muted">items recognized</div>
              <span class="badge bg-outline">89% accuracy</span>
            </div>
            <div class="col-md-2 text-center">
              <div class="rounded-circle bg-orange-500 mx-auto mb-2 icon-circle"><i class="fa-solid fa-recycle text-white fa-lg icon-circle-icon"></i></div>
              <div class="fw-semibold">Organic</div>
              <div class="fw-bold">778</div>
              <div class="small text-muted">items recognized</div>
              <span class="badge bg-outline">85% accuracy</span>
            </div>
          </div>
          <!-- Interactive EcoSort Waste Recognition -->
          <hr class="my-4">
          <div class="text-center mb-3">
            <button class="btn btn-success" data-bs-toggle="modal" data-bs-target="#ecosortModal">
              <i class="fa-solid fa-camera me-2"></i>Scan with EcoSort
            </button>
          </div>
          <div id="ecosort-recognition-result" class="text-center"></div>
        </div>
      </div>
      <!-- How Waste Gamification Works -->
      <div class="card mt-5">
        <div class="card-header fw-bold">How Waste Gamification Works <span class="text-muted small fw-normal">Engage, Learn, and Earn Rewards</span></div>
        <div class="card-body">
          <div class="row g-3">
            <div class="col-md-4">
              <div class="text-center">
                <i class="fa-solid fa-camera-retro fa-3x text-success mb-3"></i>
                <h5 class="fw-semibold">Scan</h5>
                <p class="text-muted">Use EcoSort to scan your waste items. Our AI recognizes the material and provides instant feedback.</p>
              </div>
            </div>
            <div class="col-md-4">
              <div class="text-center">
                <i class="fa-solid fa-leaf fa-3x text-success mb-3"></i>
                <h5 class="fw-semibold">Learn</h5>
                <p class="text-muted">Discover how to recycle or dispose of your items properly. Gain insights into your environmental impact.</p>
              </div>
            </div>
            <div class="col-md-4">
              <div class="text-center">
                <i class="fa-solid fa-trophy fa-3x text-success mb-3"></i>
                <h5 class="fw-semibold">Earn Rewards</h5>
                <p class="text-muted">Collect points for every scan and challenge completion. Redeem points for discounts, freebies, and more!</p>
              </div>
            </div>
          </div>
          <div class="text-center mt-4">
            <a href="#challengesSection" class="btn btn-primary">
              <i class="fa-solid fa-arrow-down me-2"></i>See Active Challenges
            </a>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Footer -->
  <footer class="footer-main mt-5 py-4 bg-bg-success text-white">
    <div class="container d-flex flex-column flex-md-row justify-content-between align-items-center">
      <div class="mb-2 mb-md-0 fw-bold">
        <i class="fa-solid fa-leaf me-2"></i>Urban Resilience Platform
      </div>
      <div class="footer-copyright small">
        &copy; 2024 Green City Hack. All rights reserved.
      </div>
      <div>
        <a href="https://github.com/" class="text-white me-3" target="_blank" rel="noopener" title="GitHub"><i class="fab fa-github"></i></a>
        <a href="mailto:info@greencityhack.com" class="text-white" title="Contact"><i class="fa fa-envelope"></i></a>
      </div>
    </div>
  </footer>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    // AJAX for EcoSort Waste Recognition
    document.getElementById('ecosortForm').addEventListener('submit', function(e) {
      e.preventDefault();
      var formData = new FormData(this);
      var resultDiv = document.getElementById('ecosort-modal-result');
      resultDiv.innerHTML = '<span class="text-muted">Classifying...</span>';
      fetch('/api/ecosort_classify', {
        method: 'POST',
        body: formData
      })
      .then(response => response.json())
      .then(data => {
        if (data.success) {
          resultDiv.innerHTML = `
            <div class="alert alert-success">
              <strong>Type:</strong> ${data.type}<br>
              <strong>Accuracy:</strong> ${data.accuracy}%<br>
              <strong>Points Awarded:</strong> ${data.points}
            </div>
          `;
          document.getElementById('ecosort-recognition-result').innerHTML = `
            <div class="alert alert-success">
              <strong>Last Scan (EcoSort):</strong> ${data.type} (${data.accuracy}% accuracy, ${data.points} points)
            </div>
          `;
        } else {
          resultDiv.innerHTML = '<div class="alert alert-danger">Classification failed. Try another image.</div>';
        }
      })
      .catch(() => {
        resultDiv.innerHTML = '<div class="alert alert-danger">Error processing image.</div>';
      });
    });
    // Clear modal result on open
    document.getElementById('ecosortModal').addEventListener('show.bs.modal', function () {
      document.getElementById('ecosort-modal-result').innerHTML = '';
    });
  </script>
</body>
</html>
